- name: Install gpg
  apt:
    name: gpg
    state: present

- name: Install Icinga key
  get_url:
    url: https://packages.icinga.com/icinga.key
    dest: /usr/share/keyrings/icinga-archive-keyring.asc

- name: Add Icinga apt repository
  apt_repository:
    repo: "deb [signed-by=/usr/share/keyrings/icinga-archive-keyring.asc] http://packages.icinga.com/debian icinga-{{ ansible_distribution_release }} main"
    state: present
    filename: icinga

- name: Install Icinga 2
  apt:
    name:
      - icinga2
  notify:
    - restart icinga2

- name: Install check plugins
  apt:
    name:
      - monitoring-plugins-basic
